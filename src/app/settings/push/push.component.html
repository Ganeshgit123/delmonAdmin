<div class="row">
  <div class="col-md-6">
    <h2 class="mb-3 mb-md-0">{{"Push Notification" | translate}}</h2>
    <br>
      <div class="card">
        <div class="card-body">
          <form [formGroup]="fcmForm">
            <div class="form-group">
              <label for="name">{{"Title" | translate}}</label>
              <input type="text" class="form-control" placeholder="{{'Enter Title' | translate}}"
                formControlName="title" [ngClass]="{ 'is-invalid': submittedFcm && fF.title.errors }">
              @if (submittedFcm && fF.title.errors) {
                <div class="invalid-feedback">
                  @if (fF.title.errors.required) {
                    <div>{{"TitleRequire" | translate}}</div>
                  }
                </div>
              }
            </div>
            <div class="form-group">
              <label for="name">{{"Message" | translate}}:</label>
              <textarea class="form-control" formControlName="message" rows="4" cols="50"
                placeholder="{{'Enter Message' | translate}}"
              [ngClass]="{ 'is-invalid': submittedFcm && fF.message.errors }"></textarea>
              @if (submittedFcm && fF.message.errors) {
                <div class="invalid-feedback">
                  @if (fF.message.errors.required) {
                    <div>{{"MessageRequired" | translate}}</div>
                  }
                </div>
              }
            </div>
            <div class="form-group">
              <label for="recipientType">{{"RecipientType" | translate}}</label>
              <select class="form-control" formControlName="recipientType"
                [ngClass]="{ 'is-invalid': submittedFcm && fF.recipientType.errors }">
                <option value="group">{{'UserGroup' | translate}}</option>
                <option value="single">{{'SingleUsers' | translate}}</option>
              </select>
              @if (submittedFcm && fF.recipientType.errors) {
                <div class="invalid-feedback">
                  @if (fF.recipientType.errors.required) {
                    <div>{{"RecipientTypeRequired" | translate}}
                    </div>
                  }
                </div>
              }
            </div>

            <!-- show group dropdown when 'group' selected -->
            @if (fcmForm.get('recipientType')?.value === 'group') {
              <div class="form-group">
                <label for="group">{{"UserGroup" | translate}}</label>
                <select class="form-control" formControlName="groupId">
                  @for (g of userGroups; track g) {
                    <option [value]="g.id">{{ g.name }}</option>
                  }
                </select>
              </div>
            }

            <!-- show single-user multiselect when 'single' selected -->
            @if (fcmForm.get('recipientType')?.value === 'single') {
              <div class="form-group">
                <label>{{ "Users" | translate }}</label>
                <mat-form-field appearance="outline" class="w-100">
                  <mat-chip-list #chipList>
                    @for (user of selectedUsers; track user; let i = $index) {
                      <mat-chip [removable]="true"
                        (removed)="removeUser(i)">
                        {{ user.text }}
                        <mat-icon matChipRemove>cancel</mat-icon>
                      </mat-chip>
                    }
                    <input placeholder="Type number or select from list" matInput [formControl]="userCtrl"
                      [matAutocomplete]="auto" [matChipInputFor]="chipList"
                      (keydown.enter)="handleEnter($event)" (keypress)="allowOnlyNumber($event)" />
                  </mat-chip-list>
                  <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectUser($event.option.value)"
                    [displayWith]="displayFn">
                    <!-- Show list -->
                    @for (option of filteredUsers | async; track option) {
                      <mat-option [value]="option">
                        {{ option.text }}
                      </mat-option>
                    }
                    <!-- Show when no match -->
                    @if ((filteredUsers | async)?.length === 0) {
                      <mat-option disabled>
                        No users found
                      </mat-option>
                    }
                  </mat-autocomplete>
                </mat-form-field>
              </div>
            }

            @if (showAccept) {
              <div class="text-right">
                <button type="submit" class="btn btn-own" (click)="sendFCMNotification()">{{"Send"
                | translate}}</button>
              </div>
            }
          </form>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <h2 class="mb-3 mb-md-0">{{"Push SMS" | translate}}</h2>
      <br>
        <div class="card">
          <div class="card-body">
            <form [formGroup]="smsForm">
              <div class="form-group">
                <label for="name">{{"Title" | translate}}</label>
                <input type="text" class="form-control" placeholder="{{'Enter Title' | translate}}"
                  formControlName="title" [ngClass]="{ 'is-invalid': submittedSms && fS.title.errors }">
                @if (submittedSms && fS.title.errors) {
                  <div class="invalid-feedback">
                    @if (fS.title.errors.required) {
                      <div>{{"TitleRequire" | translate}}</div>
                    }
                  </div>
                }
              </div>
              <div class="form-group">
                <label for="name">{{"Message" | translate}}:</label>
                <textarea class="form-control" formControlName="message" rows="4" cols="50"
                  placeholder="{{'Enter Message' | translate}}"
                [ngClass]="{ 'is-invalid': submittedSms && fS.message.errors }"></textarea>
                @if (submittedSms && fS.message.errors) {
                  <div class="invalid-feedback">
                    @if (fS.message.errors.required) {
                      <div>{{"MessageRequired" | translate}}</div>
                    }
                  </div>
                }
              </div>
              <div class="form-group">
                <label for="recipientType">{{"RecipientType" | translate}}</label>
                <select class="form-control" formControlName="recipientType"
                  [ngClass]="{ 'is-invalid': submittedSms && fS.recipientType.errors }">
                  <option value="group">{{'UserGroup' | translate}}</option>
                  <option value="single">{{'SingleUsers' | translate}}</option>
                </select>
                @if (submittedSms && fS.recipientType.errors) {
                  <div class="invalid-feedback">
                    @if (fS.recipientType.errors.required) {
                      <div>{{"RecipientTypeRequired" | translate}}
                      </div>
                    }
                  </div>
                }
              </div>

              <!-- show group dropdown when 'group' selected -->
              @if (smsForm.get('recipientType')?.value === 'group') {
                <div class="form-group">
                  <label for="group">{{"UserGroup" | translate}}</label>
                  <select class="form-control" formControlName="groupId">
                    @for (g of userGroups; track g) {
                      <option [value]="g.id">{{ g.name }}</option>
                    }
                  </select>
                </div>
              }

              <!-- show single-user multiselect when 'single' selected -->
              @if (smsForm.get('recipientType')?.value === 'single') {
                <div class="form-group">
                  <label>{{ "Users" | translate }}</label>
                  <mat-form-field appearance="outline" class="w-100">
                    <mat-chip-list #chipList>
                      @for (user of selectedUsers; track user; let i = $index) {
                        <mat-chip [removable]="true"
                          (removed)="removeUser(i)">
                          {{ user.text }}
                          <mat-icon matChipRemove>cancel</mat-icon>
                        </mat-chip>
                      }
                      <input placeholder="Type number or select from list" matInput [formControl]="userCtrl"
                        [matAutocomplete]="auto" [matChipInputFor]="chipList"
                        (keydown.enter)="handleEnter($event)" (keypress)="allowOnlyNumber($event)" />
                    </mat-chip-list>
                    <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectUser($event.option.value)"
                      [displayWith]="displayFn">
                      <!-- Show list -->
                      @for (option of filteredUsers | async; track option) {
                        <mat-option [value]="option">
                          {{ option.text }}
                        </mat-option>
                      }
                      <!-- Show when no match -->
                      @if ((filteredUsers | async)?.length === 0) {
                        <mat-option disabled>
                          No users found
                        </mat-option>
                      }
                    </mat-autocomplete>
                  </mat-form-field>
                </div>
              }

              @if (showAccept) {
                <div class="text-right">
                  <button type="submit" class="btn btn-own" (click)="sendSMS()">{{"Send"
                  | translate}}</button>
                </div>
              }
            </form>
          </div>
        </div>
      </div>
    </div>